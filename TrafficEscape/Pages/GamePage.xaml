<ContentPage
    x:Class="TrafficEscape.Pages.GamePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="Black">

    <AbsoluteLayout 
            x:Name="RootLayout"
            AbsoluteLayout.LayoutBounds="0,0,1,1"
            AbsoluteLayout.LayoutFlags="All">

        <BoxView
            Color="DarkSlateGray"
            AbsoluteLayout.LayoutBounds="0,0,1,1"
            AbsoluteLayout.LayoutFlags="All"/>

        <!-- background -->
        <Image
            Source="road.png"
            Aspect="Fill"
            Opacity="0.9"
            AbsoluteLayout.LayoutBounds="0,0,1,1"
            AbsoluteLayout.LayoutFlags="All" />

        <!-- obstacles -->
        <AbsoluteLayout x:Name="ObstacleLayer"
                        InputTransparent="True"
                        AbsoluteLayout.LayoutBounds="0,0,1,1"
                        AbsoluteLayout.LayoutFlags="All" />

        <!-- pickups -->
        <AbsoluteLayout x:Name="PickupLayer"
                        InputTransparent="True"
                        AbsoluteLayout.LayoutBounds="0,0,1,1"
                        AbsoluteLayout.LayoutFlags="All" />

        <!-- player car -->
        <Image x:Name="PlayerCarView"
               Source="car_default.png"
               AbsoluteLayout.LayoutFlags="None">
            
            <Image.WidthRequest>
                <OnPlatform x:TypeArguments="x:Double">
                    <On Platform="Android" Value="60" />
                    <On Platform="WinUI" Value="80" />
                </OnPlatform>
            </Image.WidthRequest>
            
            <Image.HeightRequest>
                <OnPlatform x:TypeArguments="x:Double">
                    <On Platform="Android" Value="120" />
                    <On Platform="WinUI" Value="160" />
                </OnPlatform>
            </Image.HeightRequest>

            <AbsoluteLayout.LayoutBounds>
                <OnPlatform x:TypeArguments="Rect">
                    <On Platform="Android" Value="0,0,60,120" />
                    <On Platform="WinUI" Value="0,0,80,160" />
                </OnPlatform>
            </AbsoluteLayout.LayoutBounds>
        </Image>
        <!-- lane grid -->
        <Grid x:Name="LaneGrid"
              AbsoluteLayout.LayoutBounds="0,0,1,1"
              AbsoluteLayout.LayoutFlags="All">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" BackgroundColor="Transparent" />
            <Grid Grid.Column="1" BackgroundColor="Transparent" />
            <Grid Grid.Column="2" BackgroundColor="Transparent" />
        </Grid>
        <!-- HUD -->
        <Grid Padding="15"
              AbsoluteLayout.LayoutBounds="0,0,1,0.2"
              AbsoluteLayout.LayoutFlags="All">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- score -->
            <VerticalStackLayout Grid.Column="0">
                <Label 
                    x:Name="ScoreLabel"
                    Text="0"
                    TextColor="Yellow"
                    FontSize="24"
                     FontAttributes="Bold"
                    AbsoluteLayout.LayoutBounds="0.05,0.05,-1,-1"
                    AbsoluteLayout.LayoutFlags="PositionProportional" />
            </VerticalStackLayout>

            <!-- coin pickup -->
            <HorizontalStackLayout Grid.Column="1"
                                   VerticalOptions="Center"
                                   Spacing="8">
                <Image Source="coin.png"
                       WidthRequest="30"
                       HeightRequest="30" />
                <Label x:Name="CoinLabel"
                       Text="0"
                       TextColor="Gold"
                       FontSize="24"
                       VerticalOptions="Center" />
            </HorizontalStackLayout>
        </Grid>

        <!-- Touch pad -->
        <Grid x:Name="TouchPad"
              AbsoluteLayout.LayoutBounds="0,0,1,1"
              AbsoluteLayout.LayoutFlags="All"
              BackgroundColor="Transparent">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            
            <!--left/right swipe-->
            <Grid.GestureRecognizers>
                <SwipeGestureRecognizer
                    Direction="Left"
                    Swiped="OnLeftSwipe" />

                <SwipeGestureRecognizer
                    Direction="Right"
                    Swiped="OnRightSwipe" />
            </Grid.GestureRecognizers>
        </Grid>
        <!--pAUSE MENU-->
        <Border BackgroundColor="#222222"
                Stroke="Gold"
                StrokeThickness="3"
                Padding="10,5"
                WidthRequest="100"
                HeightRequest="45"
                HorizontalOptions="End"
                AbsoluteLayout.LayoutBounds="0.99, 0.15, -1, -1"
                AbsoluteLayout.LayoutFlags="PositionProportional">

            <Border.StrokeShape>
                <RoundRectangle CornerRadius="10" />
            </Border.StrokeShape>

            <Border.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnPause" />
            </Border.GestureRecognizers>

            <Label Text="PAUSE" 
                   TextColor="Orange" 
                   FontAttributes="Bold" 
                   FontSize="16"
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" />
        </Border>
        <Grid x:Name="PauseOverlay" 
              IsVisible="False"
              BackgroundColor="#CC000000"
              AbsoluteLayout.LayoutBounds="0,0,1,1"
              AbsoluteLayout.LayoutFlags="All">

            <Border BackgroundColor="#1a1a1a" 
                    VerticalOptions="Center" 
                    HorizontalOptions="Center" 
                    Padding="30" WidthRequest="300">

                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="20">
                    <Label Text="PAUSED" 
                           FontSize="32" 
                           TextColor="White" 
                           HorizontalOptions="Center" />
                    <Button Text="RESUME" 
                            Clicked="OnResume" 
                            BackgroundColor="#2ecc71" />
                    <Button Text="SETTINGS" 
                            Clicked="OnSettings" 
                            BackgroundColor="#3498db" />
                    <Button Text="MAIN MENU" 
                            Clicked="OnMenu" 
                            BackgroundColor="#e74c3c" />
                </VerticalStackLayout>
            </Border>
        </Grid>
        <Grid x:Name="GameOverOverlay" 
              IsVisible="False" 
              BackgroundColor="#CC000000" 
              AbsoluteLayout.LayoutBounds="0,0,1,1" 
              AbsoluteLayout.LayoutFlags="All">
            <Border BackgroundColor="#1a1a1a" 
                    VerticalOptions="Center" 
                    HorizontalOptions="Center" 
                    Padding="30" 
                    WidthRequest="300">
                
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="15">
                    <Label Text="GAME OVER" 
                           FontSize="32" 
                           FontAttributes="Bold" 
                           TextColor="Red" 
                           HorizontalOptions="Center" />

                    <Label x:Name="NewRecordLabel"
                           Text="NEW HIGH SCORE!" 
                           IsVisible="False" 
                           TextColor="Gold" 
                           FontAttributes="Bold" 
                           HorizontalOptions="Center" />

                    <HorizontalStackLayout HorizontalOptions="Center" 
                                           Spacing="10">
                        <Label Text="SCORE:" 
                               TextColor="White" 
                               FontSize="20" />
                        <Label x:Name="FinalScoreLabel" 
                               Text="0" TextColor="Yellow"
                               FontSize="20" 
                               
                               FontAttributes="Bold" />
                    </HorizontalStackLayout>
                    
                    <HorizontalStackLayout HorizontalOptions="Center" 
                                           Spacing="10">
                        <Image Source="coin.png" 
                               WidthRequest="20" 
                               HeightRequest="20"
                               VerticalOptions="Center"/>
                        
                        <Label Text="COINS COLLECTED:" 
                               TextColor="White" 
                               FontSize="18" 
                               VerticalOptions="Center"/>
                        
                        <Label x:Name="GameOverCoinLabel" 
                               Text="0" 
                               TextColor="Gold" 
                               FontSize="20" 
                               FontAttributes="Bold" 
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout HorizontalOptions="Center" 
                                           Spacing="10">
                        <Label Text="BEST:" 
                               TextColor="Gray" 
                               FontSize="16" />
                        <Label x:Name="GameOverHighScoreLabel" 
                               Text="0" 
                               TextColor="White" 
                               FontSize="16" />
                    </HorizontalStackLayout>

                    <Button Text="TRY AGAIN" 
                            Clicked="OnRestart" 
                            BackgroundColor="#2ecc71" 
                            Margin="0,10,0,0"/>
                    <Button Text="MAIN MENU" 
                            Clicked="OnQuitToMenu" 
                            BackgroundColor="#e74c3c" />
                </VerticalStackLayout>
            </Border>
        </Grid>
    </AbsoluteLayout>
</ContentPage>
